<div id="page-wrapper">
    <div class="row">

        <div class="col-lg-12 text-center v-center">

            <h1>Đăng nhập</h1>

            <br>
            <br>
            <br>

            <form class="col-lg-12" method="POST" action="/auth/login">
                <div style="width: 340px; text-align: center; margin: 0 auto;">
                    <p id="err_msg" style="display: block;"></p>
                    <br>
                    <input class="form-control input-lg" title="User name" placeholder="User name" type="text"
                        name="username" id="username">
                    <br>
                    <input class="form-control input-lg" title="Password" placeholder="Password" type="password"
                        name="password" id="password">
                    <br>
                    <span class="">
                        <button class="btn btn-lg btn-primary" type="button" id="signin">Đăng nhập</button>
                    </span>
                </div>
            </form>
        </div>
    </div>
</div>
<script>
    $('#wrapper').attr('style', 'padding-left: 0;')
    async function postData(url = '', data = {}) {
        // Default options are marked with *
        const response = await fetch(url, {
            method: 'POST', // *GET, POST, PUT, DELETE, etc.
            mode: 'cors', // no-cors, *cors, same-origin
            cache: 'no-cache', // *default, no-cache, reload, force-cache, only-if-cached
            credentials: 'same-origin', // include, *same-origin, omit
            headers: {
                //'Content-Type': 'application/json'
                'Content-Type': 'application/x-www-form-urlencoded',
                'Accept': 'application/json'
            },
            redirect: 'follow', // manual, *follow, error
            referrerPolicy: 'no-referrer', // no-referrer, *no-referrer-when-downgrade, origin, origin-when-cross-origin, same-origin, strict-origin, strict-origin-when-cross-origin, unsafe-url
            body: `username=${data.username}&password=${data.password}` // body data type must match "Content-Type" header
        });
        if (response.status == 200)
            return response.json(); // parses JSON response into native JavaScript objects
        return response
    }
    $('#signin').on('click', (e) => {
        var username = $('#username').val();
        var password = $('#password').val();

        $('#err_msg').html('');
        if (username.trim() == '' || password.trim() == '') {
            $('#err_msg').html('Nhập username và password');
            return;
        }
        $('#mask').show();
        setTimeout(() => {
            postData('/auth/login', { username: username, password: password })
                .then(data => {
                    if (data.status == 400) {
                        $('#mask').hide();
                        $('#err_msg').html('Sai tài khoản hoặc mật khẩu');
                    }
                    else {
                        $('#mask').hide();
                        document.location.href = "/";
                    }
                });
        },1000)

    })

</script>